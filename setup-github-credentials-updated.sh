#!/bin/bash

echo "ğŸ”§ Setup GitHub Integration untuk Jenkins - Updated Version"
echo "=========================================================="
echo ""

# Konfigurasi GitHub credentials
GITHUB_USERNAME="abudlfalaq5@gmail.com"
GITHUB_TOKEN="[MASUKKAN_GITHUB_TOKEN_DI_SINI]"

echo "ğŸ“‹ Informasi Jenkins:"
echo "ğŸŒ Jenkins UI: https://bangjeje.motorsights.com"
echo "ğŸ‘¤ GitHub Username: $GITHUB_USERNAME"
echo "ğŸ”‘ GitHub Token: $GITHUB_TOKEN"
echo ""

echo "ğŸ“ Langkah-langkah setup GitHub integration:"
echo ""

echo "1ï¸âƒ£ Buka Jenkins UI di browser:"
echo "   https://bangjeje.motorsights.com"
echo ""

echo "2ï¸âƒ£ Install GitHub Plugins (Plugin yang BENAR-BENAR ada):"
echo "   - Manage Jenkins â†’ Manage Plugins"
echo "   - Tab 'Available' â†’ cari dan install:"
echo ""
echo "   ğŸ”¹ Plugin Utama:"
echo "     â€¢ GitHub Plugin (plugin utama untuk GitHub integration)"
echo "     â€¢ Git Plugin (untuk Git operations)"
echo ""
echo "   ğŸ”¹ Plugin Tambahan (opsional tapi recommended):"
echo "     â€¢ GitHub Branch Source Plugin"
echo "     â€¢ GitHub Authentication Plugin"
echo "     â€¢ Pipeline: GitHub Plugin"
echo ""
echo "   âš ï¸  JANGAN INSTALL: GitHub Pull Request Builder (ada vulnerability)"
echo ""
echo "   ğŸ“ Catatan Penting:"
echo "     - GitHub API Plugin biasanya sudah terinstall otomatis"
echo "     - Jika plugin tidak ditemukan, coba cari dengan nama yang berbeda"
echo "     - Restart Jenkins setelah install plugin"
echo ""

echo "3ï¸âƒ£ Setup GitHub Credentials:"
echo "   - Manage Jenkins â†’ Manage Credentials"
echo "   - System â†’ Global credentials â†’ Add Credentials"
echo "   - Kind: 'Secret text'"
echo "   - Secret: $GITHUB_TOKEN"
echo "   - ID: github-token"
echo "   - Description: GitHub Personal Access Token"
echo ""

echo "4ï¸âƒ£ Konfigurasi GitHub Server:"
echo "   - Manage Jenkins â†’ Configure System"
echo "   - Scroll ke bagian 'GitHub'"
echo "   - Add GitHub Server:"
echo "     â€¢ Name: GitHub"
echo "     â€¢ API URL: https://api.github.com"
echo "     â€¢ Credentials: github-token"
echo "     â€¢ Test connection (harus berhasil)"
echo ""

echo "5ï¸âƒ£ Setup Webhook (untuk auto-trigger):"
echo "   - Di repository GitHub: Settings â†’ Webhooks â†’ Add webhook"
echo "   - Payload URL: https://bangjeje.motorsights.com/github-webhook/"
echo "   - Content type: application/json"
echo "   - Events: Just the push event"
echo "   - Active: âœ“ (centang)"
echo ""

echo "6ï¸âƒ£ Test GitHub Integration:"
echo "   - Buat Multibranch Pipeline:"
echo "     â€¢ New Item â†’ Multibranch Pipeline"
echo "     â€¢ Branch Sources: GitHub"
echo "     â€¢ Credentials: github-token"
echo "     â€¢ Owner: [GitHub username atau organization]"
echo "     â€¢ Repository: [Repository name]"
echo "     â€¢ Save"
echo ""

echo "ğŸ” Troubleshooting Plugin GitHub:"
echo ""
echo "âŒ Jika plugin tidak ditemukan:"
echo "   - Cek nama plugin yang benar di https://plugins.jenkins.io/"
echo "   - Pastikan Jenkins versi terbaru"
echo "   - Restart Jenkins setelah install plugin"
echo ""
echo "âŒ Jika GitHub connection gagal:"
echo "   - Pastikan token memiliki permission yang benar"
echo "   - Cek expiry date token"
echo "   - Test connection di Configure System"
echo ""
echo "âŒ Jika webhook tidak berfungsi:"
echo "   - Pastikan URL webhook benar"
echo "   - Cek firewall settings"
echo "   - Pastikan Jenkins bisa diakses dari internet"
echo ""

echo "ğŸ“š Plugin GitHub yang Tersedia (2024):"
echo ""
echo "âœ… Plugin Utama:"
echo "   - GitHub Plugin (github-plugin)"
echo "   - Git Plugin (git-plugin)"
echo ""
echo "âœ… Plugin Tambahan (AMAN):"
echo "   - GitHub Branch Source Plugin (github-branch-source)"
echo "   - GitHub Authentication Plugin (github-oauth)"
echo "   - Pipeline: GitHub Plugin (pipeline-github)"
echo "   - GitHub Organization Folder Plugin (github-organization-folder)"
echo ""
echo "âŒ Plugin yang TIDAK AMAN (JANGAN INSTALL):"
echo "   - GitHub Pull Request Builder (ghprb) - ADA VULNERABILITY"
echo ""

echo "âœ… Setup selesai! Jenkins siap untuk GitHub integration."
echo ""
echo "ğŸ§ª Test dengan membuat Multibranch Pipeline:"
echo "   - New Item â†’ Multibranch Pipeline"
echo "   - Branch Sources: GitHub"
echo "   - Credentials: github-token"
echo "   - Owner: [GitHub username]"
echo "   - Repository: [Repository name]"
echo ""
echo "ğŸŒ Akses Jenkins: https://bangjeje.motorsights.com"
